title: Blenderでパズルのアニメーション
tags: Python 3DCG animation addon Blender
url: https://qiita.com/SaitoTsutomu/items/f334bbbc176a99309871
created_at: 2022-03-17 00:00:41+09:00
updated_at: 2022-05-08 17:59:36+09:00
body:

## Blenderでパズルのアニメーション

Blender3.1で、パズルのアニメーションをするPythonで作成したアドオンの紹介です。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/13955/c5fa72ec-3881-85cf-f68f-4188e4f409f3.gif" width="300">

## パズルのルール

- アイテムを動かして、各棒のアイテムが揃ったら完成
- アイテムは上からしか動かせない
- 移動先は、空の棒か同じアイテムの上でないといけない
- 1本の棒は4つまでしかおけない
- 同じアイテムは同時に動かせる

## アドオン動作の前提条件

- 3本以上の棒といくつかのアイテムが必要です。いずれも`puzzle`というコレクションに入っている必要があります。
- アイテムは、焼き鳥のように棒に刺さっている必要があります。
- 棒の高さは揃えてください。アイテムの高さは棒を4分割したくらいの高さで揃えてください。
- アイテムはマテリアルで区別します。1つのマテリアルにちょうど4つのアイテムが必要です。

## やり方

- [Puzzle-Anim（Blender Add-on）](https://github.com/SaitoTsutomu/Puzzle-Anim)をインストールしてください。
- サイドバーの編集タブの「Puzzle Anim」を開いてください。
- 「Make sample」を押してください。サンプルのオブジェクトを作成します。
- 「Make animation」を押してください。パズルを解くアニメーションがはじまります。

## 変更してみよう

棒とアイテムは下記のようにいくつでも置いたり場所も変えられます。
※ アイテムの追加は、アニメーションをクリアしてから行ってください。アニメーションが残っていると、追加時に位置が再設定されます。

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/13955/67fca9b3-81af-e931-0fd8-58e92bc732e6.jpeg" width="300">

アイテムを変更したら、再度、「Make animation」を押すと新しいアニメーションがはじまります。

## ロジック

- puzzuleコレクションのオブジェクトの高さを2つにクラスタリングして、高い方を棒と認識し、残りをアイテムと認識します。
- 棒の位置を初期値にして、xy座標でクラスタリングして、各棒に刺さっているアイテムを識別します。
- 深さ優先探索で解を探索します。
- 解からアニメーションを作成します。

※ クラスタリングは、自前でkmeansで行っています。

以上

